/*! CAF: cag.js
	v14.0.0 (c) 2021 Kyle Simpson
	MIT License: http://getify.mit-license.org
*/
!function UMD(e,n,t,r){"function"==typeof define&&define.amd?(t=Object.values(t),define(e,t,r)):"undefined"!=typeof module&&module.exports?(t=Object.keys(t).map((e=>require(e))),module.exports=r(...t)):(t=Object.values(t).map((e=>n[e])),n[e]=r(...t))}("CAG","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:new Function("return this")(),{"./caf.js":"CAF","./shared.js":"CAFShared"},(function DEF(e,n){"use strict";var{TIMEOUT_TOKEN:t,cancelToken:r,signalPromise:o,processTokenOrSignal:l,deferred:a,isFunction:i,isPromise:u}=n;onceEvent=e(onceEvent);let s={};s=Object.assign(CAG,{onEvent:onEvent,onceEvent:onceEvent}),s.onEvent=onEvent,s.onceEvent=onceEvent;var d=new WeakSet;const f=Symbol("unset"),v=Symbol("returned"),c=Symbol("canceled");function CAG(e){return function instance(n,...r){var o,i;if(({tokenOrSignal:n,signal:o,signalPr:i}=l(n)),o.aborted)throw o.reason||"Aborted";var s=a(),{it:h,ait:p}=function runner(e,n,t,r,...o){var l=e.call(this,{signal:r,pwait:pwait},...o);e=o=null;var a=r.pr.catch((e=>{throw{[c]:!0,reason:e}}));return a.catch((()=>{})),{it:l,ait:async function*runner(){var e,r=f;try{for(;!n.resolved;)if(r!==f?(e=r,r=f,e=l.throw(e)):e=l.next(e),u(e.value))if(d.has(e.value)){d.delete(e.value);try{if((e=await Promise.race([n,a,e.value]))===v)return}catch(e){if(e[c]){let n=l.return();throw void 0!==n.value?n.value:e.reason}r=e}}else e=yield e.value;else{if(e.done)return e.value;e=yield e.value}}finally{l=n=null,t()}}()}}(e,s.pr,onComplete,o,...r),y=p.return;return p.return=function doReturn(e){try{return s.pr.resolved=!0,s.resolve(v),Promise.resolve(h.return(e))}finally{y.call(p),onComplete()}},p;function onComplete(){n&&n!==o&&n[t]&&n.abort(),p&&(p.return=y,n=s=h=p=y=null)}}}function onEvent(e,n,t,r=!1){var o,l,u=!1,s=CAG((function*eventStream({pwait:e}){u||start();try{for(;;){if(0==o.length){let{pr:e,resolve:n}=a();o.push(e),l.push(n)}yield yield e(o.shift())}}finally{i(n.removeEventListener)?n.removeEventListener(t,handler,r):i(n.removeListener)?n.removeListener(t,handler):i(n.off)&&n.off(t,handler),o.length=l.length=0}}))(e,n,t,r);return s.start=start,s;function start(){u||(u=!0,o=[],l=[],i(n.addEventListener)?n.addEventListener(t,handler,r):i(n.addListener)?n.addListener(t,handler):i(n.on)&&n.on(t,handler))}function handler(e){if(l.length>0){l.shift()(e)}else{let{pr:n,resolve:t}=a();o.push(n),t(e)}}}function*onceEvent(e,n,t,r=!1){try{var o=onEvent(e,n,t,r);return(yield o.next()).value}finally{o.return()}}function pwait(e){var n=Promise.resolve(e);return d.add(n),n}return s}));