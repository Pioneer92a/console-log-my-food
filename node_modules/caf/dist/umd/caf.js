/*! CAF: caf.js
	v14.0.0 (c) 2021 Kyle Simpson
	MIT License: http://getify.mit-license.org
*/
!function UMD(e,n,l,r){"function"==typeof define&&define.amd?(l=Object.values(l),define(e,l,r)):"undefined"!=typeof module&&module.exports?(l=Object.keys(l).map((e=>require(e))),module.exports=r(...l)):(l=Object.values(l).map((e=>n[e])),n[e]=r(...l))}("CAF","undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:new Function("return this")(),{"./shared.js":"CAFShared"},(function DEF(e){"use strict";var{CLEANUP_FN:n,TIMEOUT_TOKEN:l,cancelToken:r,signalPromise:u,processTokenOrSignal:i}=e;let a={};function delay(e,n){var l,r;return"number"==typeof e&&"number"!=typeof n&&([n,e]=[e,n]),e&&({tokenOrSignal:e,signal:l,signalPr:r}=i(e)),l&&l.aborted?r:new Promise((function c(e,u){l&&(r.catch((function onAbort(r){i&&(clearTimeout(i),u(r||`delay (${n}) interrupted`)),e=u=i=l=null})),r=null);var i=setTimeout((function onTimeout(){e(`delayed: ${n}`),e=u=i=l=null}),n)}))}function timeout(e,n="Timeout"){e=Number(e)||0;var u=new r;return delay(u.signal,e).then(cleanup,cleanup),Object.defineProperty(u,l,{value:!0,writable:!1,enumerable:!1,configurable:!1}),u;function cleanup(){u.abort(n),u=null}}function splitSignalPRs(e){return e.reduce((function split(e,n){var l=u(n);return e[0].push(l),n.pr||e[1].push(l),e}),[[],[]])}function triggerAndCleanup(e,l,r){e.then((function t(e){l.abort(e),l=null})).then((function t(){for(let e of r)e[n]&&e[n]();r=null}))}function prCatch(e){return e.catch((e=>e))}function signalRace(e){var n=new r,[l,u]=splitSignalPRs(e);return triggerAndCleanup(prCatch(Promise.race(l)),n,u),n.signal}function signalAll(e){var n=new r,[l,u]=splitSignalPRs(e);return triggerAndCleanup(Promise.all(l.map(prCatch)),n,u),n.signal}function tokenCycle(){var e;return function getNextToken(n){return e&&(e.abort(n),e.discard()),e=new r}}function runner(e,...n){var l=e.apply(this,n);return e=n=null,{it:l,result:function getNextResult(e){try{var n=l.next(e);e=null}catch(e){return Promise.reject(e)}return function processResult(e){var n=Promise.resolve(e.value);return e.done?l=null:(n=n.then(getNextResult,(function onRejection(e){return Promise.resolve(l.throw(e)).then(processResult)}))).catch((function cleanup(){l=null})),e=null,n}(n)}()}}return a=Object.assign((function CAF(e){return function instance(n,...r){var u,a;if(({tokenOrSignal:n,signal:u,signalPr:a}=i(n)),u.aborted)return a;var o=a.catch((function onCancellation(e){try{var n=s.return();throw void 0!==n.value?n.value:e}finally{s=f=o=d=null}})),{it:s,result:f}=runner.call(this,e,u,...r),d=Promise.race([f,o]);if(n!==u&&n[l]){let e=function cancelTimer(){n.abort(),n=e=null};d.then(e,e)}else d.catch((()=>{})),n=null;return u=r=null,d}}),{cancelToken:r,delay:delay,timeout:timeout,signalRace:signalRace,signalAll:signalAll,tokenCycle:tokenCycle}),a.cancelToken=r,a.delay=delay,a.timeout=timeout,a.signalRace=signalRace,a.signalAll=signalAll,a.tokenCycle=tokenCycle,a}));