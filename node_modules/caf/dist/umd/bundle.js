/*! CAF: bundle.js
	v14.0.0 (c) 2021 Kyle Simpson
	MIT License: http://getify.mit-license.org
*/
!function UMDBundle(e,n){for(let[r,i,l]of n)"function"==typeof define&&define.amd?(i=Object.values(i),define(r,i,l)):"undefined"!=typeof module&&module.exports?(i=Object.entries(i).map((([e,n])=>module.exports[n]||require(e))),module.exports[r]=l(...i)):(i=Object.values(i).map((n=>e[n])),e[r]=l(...i))}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:new Function("return this")(),[["CAFShared",{},function DEF(){"use strict";const e=Symbol("Cleanup Function"),n=Symbol("Timeout Token");class r{constructor(n=new AbortController){var r;this.controller=n,this.signal=n.signal;var handleReject=(n,i)=>{var doRej=()=>{if(i){var e=this.signal&&this.signal.reason?this.signal.reason:void 0;i(e),i=null}};this.signal.addEventListener("abort",doRej,!1),r=()=>{this.signal&&(this.signal.removeEventListener("abort",doRej,!1),this.signal.pr&&(this.signal.pr[e]=null)),doRej=null}};this.signal.pr=new Promise(handleReject),this.signal.pr[e]=r,this.signal.pr.catch(r),handleReject=r=null}abort(e){this.signal&&!("reason"in this.signal)&&(this.signal.reason=e),this.controller&&this.controller.abort()}discard(){this.signal&&(this.signal.pr&&(this.signal.pr[e]&&this.signal.pr[e](),this.signal.pr=null),this.signal=this.signal.reason=null),this.controller=null}}let i={};function signalPromise(n){if(n.pr)return n.pr;var r,i=new Promise((function c(e,i){r=()=>i(),n.addEventListener("abort",r,!1)}));return i[e]=function cleanup(){n&&(n.removeEventListener("abort",r,!1),n=null),i&&(i=i[e]=r=null)},i.catch(i[e]),i}function processTokenOrSignal(e){e instanceof AbortController&&(e=new r(e));var n=e&&e instanceof r?e.signal:e;return{tokenOrSignal:e,signal:n,signalPr:signalPromise(n)}}function deferred(){var e;return{pr:new Promise((n=>e=n)),resolve:e}}function isFunction(e){return"function"==typeof e}function isPromise(e){return e&&"object"==typeof e&&"function"==typeof e.then}return i={CLEANUP_FN:e,TIMEOUT_TOKEN:n,cancelToken:r,signalPromise:signalPromise,processTokenOrSignal:processTokenOrSignal,deferred:deferred,isFunction:isFunction,isPromise:isPromise},i.CLEANUP_FN=e,i.TIMEOUT_TOKEN=n,i.cancelToken=r,i.signalPromise=signalPromise,i.processTokenOrSignal=processTokenOrSignal,i.deferred=deferred,i.isFunction=isFunction,i.isPromise=isPromise,i}],["CAF",{"./shared.js":"CAFShared"},function DEF(e){"use strict";var{CLEANUP_FN:n,TIMEOUT_TOKEN:r,cancelToken:i,signalPromise:l,processTokenOrSignal:o}=e;let a={};function delay(e,n){var r,i;return"number"==typeof e&&"number"!=typeof n&&([n,e]=[e,n]),e&&({tokenOrSignal:e,signal:r,signalPr:i}=o(e)),r&&r.aborted?i:new Promise((function c(e,l){r&&(i.catch((function onAbort(i){o&&(clearTimeout(o),l(i||`delay (${n}) interrupted`)),e=l=o=r=null})),i=null);var o=setTimeout((function onTimeout(){e(`delayed: ${n}`),e=l=o=r=null}),n)}))}function timeout(e,n="Timeout"){e=Number(e)||0;var l=new i;return delay(l.signal,e).then(cleanup,cleanup),Object.defineProperty(l,r,{value:!0,writable:!1,enumerable:!1,configurable:!1}),l;function cleanup(){l.abort(n),l=null}}function splitSignalPRs(e){return e.reduce((function split(e,n){var r=l(n);return e[0].push(r),n.pr||e[1].push(r),e}),[[],[]])}function triggerAndCleanup(e,r,i){e.then((function t(e){r.abort(e),r=null})).then((function t(){for(let e of i)e[n]&&e[n]();i=null}))}function prCatch(e){return e.catch((e=>e))}function signalRace(e){var n=new i,[r,l]=splitSignalPRs(e);return triggerAndCleanup(prCatch(Promise.race(r)),n,l),n.signal}function signalAll(e){var n=new i,[r,l]=splitSignalPRs(e);return triggerAndCleanup(Promise.all(r.map(prCatch)),n,l),n.signal}function tokenCycle(){var e;return function getNextToken(n){return e&&(e.abort(n),e.discard()),e=new i}}function runner(e,...n){var r=e.apply(this,n);return e=n=null,{it:r,result:function getNextResult(e){try{var n=r.next(e);e=null}catch(e){return Promise.reject(e)}return function processResult(e){var n=Promise.resolve(e.value);return e.done?r=null:(n=n.then(getNextResult,(function onRejection(e){return Promise.resolve(r.throw(e)).then(processResult)}))).catch((function cleanup(){r=null})),e=null,n}(n)}()}}return a=Object.assign((function CAF(e){return function instance(n,...i){var l,a;if(({tokenOrSignal:n,signal:l,signalPr:a}=o(n)),l.aborted)return a;var s=a.catch((function onCancellation(e){try{var n=u.return();throw void 0!==n.value?n.value:e}finally{u=f=s=d=null}})),{it:u,result:f}=runner.call(this,e,l,...i),d=Promise.race([f,s]);if(n!==l&&n[r]){let e=function cancelTimer(){n.abort(),n=e=null};d.then(e,e)}else d.catch((()=>{})),n=null;return l=i=null,d}}),{cancelToken:i,delay:delay,timeout:timeout,signalRace:signalRace,signalAll:signalAll,tokenCycle:tokenCycle}),a.cancelToken=i,a.delay=delay,a.timeout=timeout,a.signalRace=signalRace,a.signalAll=signalAll,a.tokenCycle=tokenCycle,a}],["CAG",{"./caf.js":"CAF","./shared.js":"CAFShared"},function DEF(e,n){"use strict";var{TIMEOUT_TOKEN:r,cancelToken:i,signalPromise:l,processTokenOrSignal:o,deferred:a,isFunction:s,isPromise:u}=n;onceEvent=e(onceEvent);let f={};f=Object.assign(CAG,{onEvent:onEvent,onceEvent:onceEvent}),f.onEvent=onEvent,f.onceEvent=onceEvent;var d=new WeakSet;const g=Symbol("unset"),v=Symbol("returned"),h=Symbol("canceled");function CAG(e){return function instance(n,...i){var l,s;if(({tokenOrSignal:n,signal:l,signalPr:s}=o(n)),l.aborted)throw l.reason||"Aborted";var f=a(),{it:p,ait:m}=function runner(e,n,r,i,...l){var o=e.call(this,{signal:i,pwait:pwait},...l);e=l=null;var a=i.pr.catch((e=>{throw{[h]:!0,reason:e}}));return a.catch((()=>{})),{it:o,ait:async function*runner(){var e,i=g;try{for(;!n.resolved;)if(i!==g?(e=i,i=g,e=o.throw(e)):e=o.next(e),u(e.value))if(d.has(e.value)){d.delete(e.value);try{if((e=await Promise.race([n,a,e.value]))===v)return}catch(e){if(e[h]){let n=o.return();throw void 0!==n.value?n.value:e.reason}i=e}}else e=yield e.value;else{if(e.done)return e.value;e=yield e.value}}finally{o=n=null,r()}}()}}(e,f.pr,onComplete,l,...i),y=m.return;return m.return=function doReturn(e){try{return f.pr.resolved=!0,f.resolve(v),Promise.resolve(p.return(e))}finally{y.call(m),onComplete()}},m;function onComplete(){n&&n!==l&&n[r]&&n.abort(),m&&(m.return=y,n=f=p=m=y=null)}}}function onEvent(e,n,r,i=!1){var l,o,u=!1,f=CAG((function*eventStream({pwait:e}){u||start();try{for(;;){if(0==l.length){let{pr:e,resolve:n}=a();l.push(e),o.push(n)}yield yield e(l.shift())}}finally{s(n.removeEventListener)?n.removeEventListener(r,handler,i):s(n.removeListener)?n.removeListener(r,handler):s(n.off)&&n.off(r,handler),l.length=o.length=0}}))(e,n,r,i);return f.start=start,f;function start(){u||(u=!0,l=[],o=[],s(n.addEventListener)?n.addEventListener(r,handler,i):s(n.addListener)?n.addListener(r,handler):s(n.on)&&n.on(r,handler))}function handler(e){if(o.length>0){o.shift()(e)}else{let{pr:n,resolve:r}=a();l.push(n),r(e)}}}function*onceEvent(e,n,r,i=!1){try{var l=onEvent(e,n,r,i);return(yield l.next()).value}finally{l.return()}}function pwait(e){var n=Promise.resolve(e);return d.add(n),n}return f}]]);